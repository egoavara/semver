name: Release

on:
    workflow_dispatch:
        inputs:
            type:
                type: choice
                required: true
                default: next-patch
                description: "Versioning type"
                options:
                    - "nextpatch"
                    - "nextminor"
                    - "nextmajor"
            title:
                type: string
                default: Auto Release
                description: "Release title"
            body:
                type: string
                default: Github Action auto released
                description: "Release body"

jobs:
    release:
        permissions: write-all
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v2
            - name: Guess semver
              id: semver
              uses: egoavara/semver@v0.0.5
              with:
                  value-type: ${{ inputs.type }}
            - name: Create Release
              id: create_release
              uses: actions/create-release@v1
              env:
                  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
              with:
                  tag_name: ${{ steps.semver.outputs.value }}
                  release_name: "Release ${{ steps.semver.outputs.value }} : ${{ github.event.inputs.title }}"
                  body: ${{ github.event.inputs.body }}
            - uses: rickstaa/action-create-tag@v1
              with:
                  tag: "latest"
                  force_push_tag: true
                  message: "Latest release"
            - uses: rickstaa/action-create-tag@v1
              with:
                  tag: "${{steps.semver.outputs.value-nominor}}"
                  force_push_tag: true
                  message: "${{steps.semver.outputs.value-nominor}} release"
            - uses: rickstaa/action-create-tag@v1
              with:
                  tag: "${{steps.semver.outputs.value-nopatch}}"
                  force_push_tag: true
                  message: "${{steps.semver.outputs.value-nopatch}} release"
